\documentclass{article}

%Headers
\usepackage[dvips]{graphicx}    %package that does pdfs
\usepackage{color}              %this needs to be here also
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{float}
\usepackage{authblk}



\lstdefinestyle{pythonstyle}{
  language=Python,
  basicstyle=\small\ttfamily,
  keywordstyle=\color{blue},
  commentstyle=\color{green},
  stringstyle=\color{black},
  showstringspaces=false,
  tabsize=4,
  frame=single,
  numbers=left,
  numberstyle=\tiny\color{black},
  stepnumber=1,
  numbersep=8pt,
  firstnumber=1,
  breaklines=true,
  xleftmargin=15pt,
  framexleftmargin=15pt,
  backgroundcolor=\color{white},
  captionpos=b
}



\title{Практическая работа по дисциплине "Нейроэволюционные вычисления"}
\author{Выполнил: Малкин Артем Юрьевич\\ Студент гр. 8ВМ22 \and Проверил: Григорьев Дмитрий Сергеевич\\ Старший преподаватель ОИТ ИШИТР ТПУ}



\date{19 Мая 2023}

\begin{document}
\maketitle

%Note that the '*' surpresses the section numbering
\section*{Номенклатура}
\label{sec:nomenclature}
\begin{tabbing}
    XXXXXXXX \= \kill% this line sets tab stop
	NEAT				\> NeuroEvolution of Augmenting Topology\\  
	IoU					\> Intersection over Union\\    
	CUDA				\> Compute Unified Device Architecture\= \kill    
	IN 					\> Innovation Number 
\end{tabbing}

\section*{Цель работы}
Реализовать алгоритм NEAT для решения задачи определения людей, больных диабетом, по данным анализов. 

\section{Ход работы}
\subsection{Используемые программные модули}

В рамках практической работы был разработан программный код с применением модуля neat-python для реализации нейроэволюционного алгоритма NEAT. Для отображения схемы получившейся нейронной сети используется модуль networkx (создание объектов для дальнейшего их отображения) и matplotlib. \\

Модуль pandas используется для загрузки данных о людях, больных диабетом. Датасет представлен на сайте Kaggle\cite{Kaggle_dataset}. Программный код был разработан на языке Python.


\subsection{Описание алгоритма NEAT}
Алгоритм NEAT предназначен для поиска оптимальной структуры нейронной сети, которая разрешит поставленную задачу. К примеру, задача определения людей, больных диабетом или раком, на основании анализов. Поиск оптимальной структуры нейронной сети предполагает поиск: 

\begin{itemize}
    \item Оптимального количества нейронов в скрытом слое сети, определение их связей.
    \item Оптимальных весовых коэффициентов для связей между нейронами.
\end{itemize}

Алгоритм NEAT оперирует инновационными числами (Innovation Numbers - IN), который содержит информацию о связях между нейронами, их весовом коэффициенте и включена ли эта связь. На рисунке ~\ref{fig:Neat1} (взят из оригинальной статьи создателя алгоритма Kenneth O. Stanley \cite{Stanley_NEAT}) сверху показан пример мутации нейронной сети: добавлена связь от нейрона 3 к нейрону 5. Поскольку такой связи ранее не было, этой информации о связи присваивается очередное IN. Если в ходе мутации создалась бы связь, которая уже участвовала в нейроэволюционном алгоритме, только что созданная связь получит то же IN.

На том же рисунке снизу при создании нового узла (Node) определились связи от нейрона 3 к нейрону 6 и от 6 к 4. Поскольку ранее была связь от 3 и 5 (IN = 7), а сейчас его нет, то данный представитель популяции лишается в своём фенотипе  информации о этой связи.

%Illustrate inserting a figure
\begin{figure}[h]
	\centering
    \includegraphics[width=3in]{neat1}
    \caption{Процесс мутации нейронной сети }
    \label{fig:Neat1}
\end{figure}

До того, как начать мутации, необходимо создать популяцию особей, а также произвести отбор особей. Оценка того, насколько особь приспособлена к решению поставленной задачи, происходит по заданной пользователем функции (fitness function). Те особи, что более близки к требуемым значениям (этап селекции), имеют больше шансов на скрещивание.

Скрещивание происходит по трём действиям:
\begin{enumerate}
    \item Сопоставление генов. Гены - связи между узлами (нейронами) в сети. Совпадающие гены - те, которые имеют одинаковые IN, указывающие на происхождение генов. Совпадающие гены наследуются случайным образом от одного из родителей потомству.
    \item Несовпадающие и избыточные гены. Несовпадающие - те, у которых различные IN и они находятся в одинаковом положении в геноме. Избыточные гены - гены с инновационным числом, превышающим число генов другого родителя. Оба типа генов наследуются от более приспособленного родителя без изменений.
    Если IN у генов совпадает, но различны состояния активности (enable/disable), то используется элемент случайности, согласно которой с некоторой долей вероятности потомок получит активированный или неактивированный ген. Это состояние может измениться в процессе мутации.
    \item Весовые коэффициенты связей. После определения структурных генов устанавливаются веса связей между генами потомства. Одним из методов является усреднение весов связей совпадающих генов обоих родителей. 
\end{enumerate}

На рисунке ~\ref{fig:Neat2} продемонстрирован пример операции кроссовера (скрещивания) особей для создания потомства.

%Illustrate inserting a figure
\begin{figure}[h]
	\centering
    \includegraphics[width=3in]{neat2}
    \caption{Операция кроссовера особей}
    \label{fig:Neat2}
\end{figure}

Вместо того, что огульно тратить пули, пытаясь случайно попасть в оптимальную структуру сети, можно использовать хитрый алгоритм NEAT. Пули не работают, Жон (рисунок ~\ref{fig:Jon}).

\begin{figure}[h]
	\centering
    \includegraphics[width=3in]{jon1}
    \caption{Bullets don't work, Jon}
    \label{fig:Jon}
\end{figure}

Вот так.


%Illustrate breaking the document into several .tex files and then including them together with 'input'
\input{ProgramCode}

\section{Результаты работы}

В датасете содержится 784 записей о людях, которые могут быть больны диабетом. В результате работы нейроэволюционного алгоритма NEAT в количестве 300 поколений была получена модель, значение фитнес-функции которой составляет 541 (то есть из 784 данных записей она правильно предскажет наличие или отсутствие болезни в 541 случае).

Был получен словарь (Python Dictionary), содержащий информацию о связях между нейронами входного, скрытого, выходного слоёв. Информация (рисунок ~\ref{fig:Output3}) включает в себя сведения о:

\begin{itemize}
    \item Скрытых и выходном нейронах: смещение, функция активации, способ агрегации.
    \item Связях между нейронами: входной и выходной нейроны, весовой коэффициент, активирована ли связь.
\end{itemize}

\begin{figure}[h]
	\centering
    \includegraphics[width=4in]{output3}
    \caption{Выходные данные о лучшей модели (в отчёте приведён неполный список Connections)}
    \label{fig:Output3}
\end{figure}

Была проведена оценка качества предсказания метриками Accuracy и Precision, IoU. Были определены следующие значения TP, TN, FP, FN:

\begin{itemize}
    \item TP: 83 (столько человек действительно болеют диабетом, модель корректно их определила как больных людей).
    \item TN: 458 (человек не болеет, система полагает так же).
    \item FP: 42 (человек не болеет диабетом, но модель считает иначе).
    \item FN: 185 (человек болеют диабетом, но система не опредилила их).    
\end{itemize}

Таким образом, значение метрики Accuracy составляет 0.7044, Precision - 0.664, IoU - 0.2677. Эти метрики говорят о не лучшем определении людей, больных диабетом, как людей, которые болеют диабетом. Но модель показывает хорошие результаты, когда нужно подтвердить, что человек не болен диабетом.

На рисунке ~\ref{fig:Output1} представлен график значений фитнес-функции у лучшей модели и в среднем по поколению (с учётом стандартного отклонения).

\begin{figure}[h]
	\centering
    \includegraphics[width=3in]{output1}
    \caption{Среднее и лучшее значения фитнес-функции у популяции}
    \label{fig:Output1}
\end{figure}

На рисунке ~\ref{fig:Output2} представлена cхема нейронной сети лучшей модели. На рисунке цифрами [-8:0] обозначены:
\begin{itemize}
    \item 0: выходной сигнал (1 или 0 - болен или здоров)
    \item -1: Pregnancies - количество беременностей
    \item -2: Glucose - концентрация глюкозы в плазме через 2 часа после пероральной нагрузки
    \item -3: BloodPressure - диастолическое артериальное давление (мм рт. ст.)
    \item -4: SkinThickness - толщина кожной складки (мм)
    \item -5: Insulin - 2-часовой сывороточный инсулин (мкЕд/мл)
    \item -6: BMI - индекс массы тела (масса в кг / (рост в м)**2)
    \item -7: DiabetesPedigreeFunction - функция родословной диабета
    \item -8: Age - возраст (полных лет)
\end{itemize}

\begin{figure}[h]
	\centering
    \includegraphics[width=3in]{output2}
    \caption{Структура лучшей модели}
    \label{fig:Output2}
\end{figure}

Для оценки промежуточного результата есть возможность изучать значения фитнес-функции есть встроенный в neat-python инструментарий (рисунок ~\ref{fig:Output4}).

\begin{figure}[h]
	\centering
    \includegraphics[width=3in]{output4}
    \caption{Оценка фитнес-функции у особей данного поколения}
    \label{fig:Output4}
\end{figure}

\section*{Заключение}
В ходе выполнения практической работы было получение представление работы алгоритма NEAT в задачах поиска оптимальной структуры нейронной сети. Разработан программный код с применением модуля neat-python для реализации данного алгоритма на языке высокого уровня Python. Реализована функция отображения структуры нейронной сети, полученной в результате работы алгоритма NEAT. Получен опыт работы с набором макрорасширений системы компьютерной вёрстки TeX.

%Illustrate creating a bibliography by referring to an external bibliography file (SampleBibliography.bib).  Note that you must chose a style to determine how the bibliography is presented
\bibliography{SampleBibliography}
\bibliographystyle{aiaa}

\end{document}
